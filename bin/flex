#!/usr/bin/python3

import os
import sys

import importlib


if __name__ == '__main__':
    if len(sys.argv) < 3:
        sys.exit(f'usage: {sys.argv[0]} <mode> <snap>')

    mode = sys.argv[1]
    snap = sys.argv[2]

    if mode == 'timing':
        snap = os.path.join(snap, 'adv')

    os.environ['FLEXUS_LOG_OVERRIDE'] = f'{mode}.log'

    spec = importlib.util.spec_from_loader('runq', importlib.machinery.SourceFileLoader('runq', 'runq'))
    runq = importlib.util.module_from_spec(spec)

    spec.loader.exec_module(runq)

    runq.main(
        os.environ.get('RUNQ_ARGS', ''),
            f'+{mode}',
            f'+snap={snap}',
            f'+stdout={snap}/{mode}.out',
            '+stderr=-'
    )
