#!/usr/bin/zsh

set -e

cd ${0:A:h:h}

conf=1-8k_32k_2m
work=media
type=0
mode=timing

while (( ${#} )); do
    case ${1} in
        -c=*)
            conf=${1##*=}
            ;;
        -w=*)
            work=${1##*=}
            ;;
        -t=*)
            type=${1##*=}
            ;;
        -m=*)
            mode=${1##*=}
            ;;
    esac

    shift
done

mkdir -p res

aux/calc_lat "${conf}/${work}_${type}_\\d+_\\d+/${mode}.bin"        \
    > res/${work}.${type}.${conf}.lat.csv

aux/calc_pmc "${conf}/${work}_${type}_\\d+_\\d+/${mode}.gz" ${mode} \
    > res/${work}.${type}.${conf}.pmc.csv
